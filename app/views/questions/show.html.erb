<% if @anchor %>
  <script type="text/javascript">
    window.location.hash = "<%= @anchor %>";
  </script>
<% end %>

<div class="page-container">

    <div class="question-container" data-id="<%= @question.id %>">
        <h2>
        <% if current_user %>
            <%= link_to question_user_like_path(@question, current_user), :class => "like-btn #{'liked' if current_user.liked? @question}", method: :put, remote: true do %>
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-up not-logged-in" aria-hidden="true"></i>
        <% end %>
        <span class="num-upvotes">
            <%= @question.get_upvotes.size - @question.get_downvotes.size %>
        </span>
        <% if current_user %>
            <%= link_to question_user_dislike_path(@question, current_user), :class => "dislike-btn #{'liked' if current_user.disliked? @question}", method: :put, remote: true do %>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-down not-logged-in" aria-hidden="true"></i>
        <% end %>
        </h2>
        <h3><%= @question.title %></h3>
        <% if @question.url && !@question.url.empty? %>
            <div class="video-container">
                <%= get_video_iframe(@question.url) %>
            </div>
        <% end %>

        <%= simple_format(@question.body) %>
        
        <%= link_to "Add a Comment", new_qcomment_path(:question_id => @question) %>

        <div class="comments-container">
            <% @question.qcomments.each do |comment| %>
                <% if comment.parent_id.blank? %>
                    <div class="comment-box">
                        <%= render :partial=>"qcomment", locals: {comment: comment} %>
                    </div>
                <% end %>
            <% end %>
        </div>
    </div>

<h3><%= @question.answers.count %> answers</h3>

<% @question.answers.order(cached_weighted_score: :desc, created_at: :desc).each do |answer| %>
    <div class="answer answer-container" data-id="<%= answer.id %>">
        <h2>
        <% if current_user %>
            <%= link_to answer_user_like_path(answer, current_user), :class => "like-btn #{'liked' if current_user.liked? answer}", method: :put, remote: true do %>
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-up not-logged-in" aria-hidden="true"></i>
        <% end %>
        <span class="likes-count"><%= answer.get_upvotes.size - answer.get_downvotes.size %></span>

        <% if current_user %>
            <%= link_to answer_user_dislike_path(answer, current_user), :class => "dislike-btn #{'liked' if current_user.disliked? answer}", method: :put, remote: true do %>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-down not-logged-in" aria-hidden="true"></i>
        <% end %>
        </h2>

        <div class="video-container">
            <% if answer.url && !answer.url.empty? %>
                <%= get_video_iframe(answer.url) %>
            <% end %>
        </div>
        
        
        <%= simple_format(answer.body) %>
        <div>by: <%= answer.user.displayName %></div>
        <% if current_user == answer.user %>
            <%= link_to "Edit Answer", edit_answer_path(answer), method: :get %>
        <% end %>

        <br><%= link_to "Reply", new_acomment_path(:answer_id => answer) %>
    </div>

    <div class="comments-container">
        <% answer.acomments.each do |comment| %>
            <% if comment.parent_id.blank? %>
                <div class="comment-box">
                    <%= render :partial=>"comment", locals: {comment: comment} %>
                </div>
            <% end %>
        <% end %>
    </div>

<% end %>

<h3 id="anchor_point">Your Answer</h3>
    <% if flash[:alert] && flash[:alert] != "You are already signed in." %>
        <div class="notice"><%= flash.now[:alert].html_safe %></div>
    <% end %>

<% if current_user %>
    <%= form_for(@answer) do |f| %>
        <%= f.hidden_field :question_id, :value => @question.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= f.label :url, "Screencast URL" %>
        <%= f.text_field :url, :class => "url-input" %><br><br>
        <%= f.text_area :body, :class => "tinymce" %>

    <%= tinymce %>
    <br>
    <%= f.submit "Post Your Answer", :class => "submit-btn" %>
    <% end %>
<% else %>
    <p>You must be signed in to submit an answer.</p>
<% end %>
<br>

</div>