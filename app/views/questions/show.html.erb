<% if @anchor %>
  <script type="text/javascript">
    window.location.hash = "<%= @anchor %>";
  </script>
<% end %>

<%= @question.title %><br>

<% if @question.url && !@question.url.empty? %>
    <%= get_video_iframe(@question.url) %>
<% end %>

<%= simple_format(@question.body) %>

<br><br>

<h3 id="anchor_point">Your Answer</h3><br>

<% if flash[:notice] %>
    <div class="notice"><%= flash[:notice] %></div>
<% end %>

<% if current_user %>
    <%= form_for(@answer) do |f| %>
        <%= f.hidden_field :question_id, :value => @question.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= f.label :url, "Screencast URL" %>
        <%= f.text_field :url %><br><br>
        <%= f.text_area :body, :class => "tinymce", :rows => 10, :cols => 120 %>

    <%= tinymce %>
    <br>
    <%= f.submit %>
    <% end %>
<% else %>
    <p>You must be signed in to submit an answer.</p>
<% end %>
<br><br>

<% @question.answers.order(cached_votes_total: :desc, created_at: :desc).each do |answer| %>
    <div class="answer" data-id="<%= answer.id %>">
        <% if current_user %>
            <%= link_to answer_user_like_path(answer, current_user), method: :put, class: "like-btn #{'liked' if current_user.liked? answer}", remote: true do %>
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-up not-logged-in" aria-hidden="true"></i>
        <% end %>
        <strong>Votes: </strong><span class="likes-count"><%= answer.get_upvotes.size - answer.get_downvotes.size %></span>

        <% if current_user %>
            <%= link_to answer_user_dislike_path(answer, current_user), method: :put, class: "dislike-btn #{'liked' if current_user.disliked? answer}", remote: true do %>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
            <% end %>
        <% else %>
                <i class="fa fa-chevron-down not-logged-in" aria-hidden="true"></i>
            <% end %>

        <div>
            <% if answer.url && !answer.url.empty? %>
                <%= get_video_iframe(answer.url) %>
            <% end %>
        </div>
        
        
        <%= simple_format(answer.body) %>
        <div>by: <%= answer.user.displayName %></div>
        <% if current_user == answer.user %>
            <%= link_to "Edit Answer", edit_answer_path(answer), method: :get %>
        <% end %>

        <br><%= link_to "Reply", new_acomment_path(:answer_id => answer) %>
    </div>

    <% answer.acomments.each do |comment| %>
        <div>
            <%= comment.body if comment.parent_id.blank? %>
            <%= link_to "Reply", new_acomment_path(:parent_id => comment, :answer_id => comment.answer) if comment.parent_id.blank? %>
            <div>
                <% comment.replies.each do |reply| %>
                    <%= reply.body %>
                    <%= link_to "Reply", new_acomment_path(:parent_id => reply, :answer_id => reply.answer) %>
                <% end %>
            </div>
        </div>
    <% end %>


<% end %>
