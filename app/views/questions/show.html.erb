<% if @anchor %>
  <script type="text/javascript">
    window.location.hash = "<%= @anchor %>";
  </script>
<% end %>

<div class="page-container">

    <div class="question-container">
        <h3><%= @question.title %></h3>

        <% if @question.url && !@question.url.empty? %>
            <%= get_video_iframe(@question.url) %>
        <% end %>

        <%= simple_format(@question.body) %>
    </div>

<h3><%= @question.answers.count %> answers</h3>

<% @question.answers.order(cached_votes_total: :desc, created_at: :desc).each do |answer| %>
    <div class="answer-container" data-id="<%= answer.id %>">
        <h2>
        <% if current_user %>
            <%= link_to answer_user_like_path(answer, current_user), method: :put, class: "like-btn #{'liked' if current_user.liked? answer}", remote: true do %>
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-up not-logged-in" aria-hidden="true"></i>
        <% end %>
        <span class="likes-count"><%= answer.get_upvotes.size - answer.get_downvotes.size %></span>

        <% if current_user %>
            <%= link_to answer_user_dislike_path(answer, current_user), method: :put, class: "dislike-btn #{'liked' if current_user.disliked? answer}", remote: true do %>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
            <% end %>
        <% else %>
            <i class="fa fa-chevron-down not-logged-in" aria-hidden="true"></i>
        <% end %>
        </h2>

        <div>
            <% if answer.url && !answer.url.empty? %>
                <%= get_video_iframe(answer.url) %>
            <% end %>
        </div>
        
        
        <%= simple_format(answer.body) %>
        <div>by: <%= answer.user.displayName %></div>
        <% if current_user == answer.user %>
            <%= link_to "Edit Answer", edit_answer_path(answer), method: :get %>
        <% end %>

        <br><%= link_to "Reply", new_acomment_path(:answer_id => answer) %>
    </div>

    <div class="comments-container">
        <% answer.acomments.each do |comment| %>
            <% if comment.parent_id.blank? %>
                <div class="comment-box">
                    <%= render :partial=>"comment", locals: {comment: comment} %>
                </div>
            <% end %>
        <% end %>
    </div>

<% end %>

<h3 id="anchor_point">Your Answer</h3>

<% if flash[:notice] %>
    <div class="notice"><%= flash[:notice] %></div>
<% end %>

<% if current_user %>
    <%= form_for(@answer) do |f| %>
        <%= f.hidden_field :question_id, :value => @question.id %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%= f.label :url, "Screencast URL" %>
        <%= f.text_field :url %><br><br>
        <%= f.text_area :body, :class => "tinymce", :rows => 10, :cols => 120 %>

    <%= tinymce %>
    <br>
    <%= f.submit "Post Your Question" %>
    <% end %>
<% else %>
    <p>You must be signed in to submit an answer.</p>
<% end %>
<br>

</div>